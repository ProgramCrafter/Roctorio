#:set UNIT 60
# UNIT = 40: 1920x1080 -> 48x27
# UNIT = 60: 1920x1080 -> 32x18


#:set SIZE 128
#:set OFFSET_X SIZE * 1 / 4 * (3 ** 0.5)
#:set OFFSET_Y SIZE * 3 / 4

<ColouredWidget@Widget>:
  backcolor:       0.1, 0.1, 0.1, 1
  forecolor:       1.0, 1.0, 1.0, 1
  
  color:           self.forecolor
  
  canvas.before:
    Color:
      rgba:        self.backcolor
    Rectangle:
      pos:         self.pos
      size:        self.size

<ColouredLabel@ColouredWidget+Label>:
  font_size:            16

<ColouredFloatLayout@ColouredWidget+FloatLayout>:

### position utils ###
<HexPositionable@Widget>:
  px:                   0
  py:                   0
  dx:                   0
  dy:                   0
  
  pos:                  (self.px * 2 + self.py) * OFFSET_X + self.dx, (self.py) * OFFSET_Y + self.dy

<MechanismDeltaCalc@HexPositionable>:
  side:                 0
  dx:                   (OFFSET_X + SIZE / 2 if self.side in [0, 1] else (OFFSET_X / 2 + SIZE / 4 if self.side in [2, 5] else 0)) - 8
  dy:                   (OFFSET_Y if self.side in [0, 4] else (SIZE / 4 if self.side in [1, 3] else (SIZE if self.side == 5 else 0))) - 8

### position utils end ###

### drawing utils ###
<HexagonDrawer@Widget>:
  tx_source:            'assets\\tiles\\desert-256-b.png'
  
  size_hint:            None, None
  size:                 SIZE, SIZE
  
  canvas.after:
    Color:
      rgba:             1.0, 1.0, 1.0, 1
    
    Ellipse:
      segments:         6
      pos:              self.pos
      size:             self.size
      source:           self.tx_source

### drawing utils end ###

<Hex@HexPositionable+HexagonDrawer>:

<Decoration@HexPositionable>:
  tx_source:            'assets\\decorations\\copper-pipe-16-76.png'
  
  side:                 0
  
  dec_offset:           6
  
  size_hint:            None, None
  width:                16
  height:               SIZE / 2 + self.dec_offset * 2
  
  canvas.after:
    Color:
      rgba:             1.0, 1.0, 1.0, 1
    
    PushMatrix
    Rotate:
      angle:            360 - 60 * self.side
      origin:           self.x + OFFSET_X + 8, self.y + SIZE / 2
    
    Rectangle:
      pos:              self.x + OFFSET_X * 2, self.y + SIZE / 4 - self.dec_offset
      size:             self.size
      source:           self.tx_source
    
    PopMatrix

<Mechanism@MechanismDeltaCalc>:
  size_hint:            None, None
  size:                 16, 16
  
  canvas.after:
    Color:
      rgba:             1, 1, 0, 1
    
    Ellipse:
      pos:              self.pos
      size:             self.size
      

<InfiniteHexGrid@FloatLayout>:

<GameInterface@ColouredFloatLayout>:
  backcolor:            1.0, 1.0, 1.0, 1
  
  ColouredLabel:
    id:                 tps_meter
    
    backcolor:          0.8, 0.8, 0.8, 1
    forecolor:          0.0, 0.0, 0.0, 1
    
    size_hint:          None, None
    size:               UNIT * 3, UNIT
    pos_hint:           {'top': 1, 'left': 0}
    
  InfiniteHexGrid:
    id:                 playground
